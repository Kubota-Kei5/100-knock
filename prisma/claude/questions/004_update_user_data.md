# 問題004: ユーザー情報の更新（部分実装形式）

## 問題内容

Prisma Clientを使用して、既存のUserレコードを更新するプログラムを**自分で実装**してください。

`workspace/problems/problem-004.ts`には部分的なテンプレートが用意されています。**TODOコメント部分を実装**して完成させてください。

### 💪 実装チャレンジ（難易度UP）

問題003より実装の自由度が高くなります：

1. **updateメソッドの使用** - 既存レコードの更新
2. **upsertメソッドの使用** - 存在チェック付き更新/作成
3. **存在しないIDの更新エラー** - 実務でよくある落とし穴
4. **条件付き更新** - 複数フィールドの更新

### 🎯 更新タスク

以下の更新処理を実装してください：

#### タスク1: 田中太郎の年齢更新
- **対象**: ID: 1のユーザー（田中太郎）
- **更新内容**: age を 25 → 26 に更新
- **実装**: `prisma.user.update()` を使用

#### タスク2: 存在しないユーザーの更新（エラー体験）
- **対象**: ID: 999のユーザー（存在しない）
- **期待結果**: エラーが発生し、適切に処理されること
- **実務ポイント**: 存在確認なしの更新は危険

#### タスク3: upsertによる安全な更新
- **対象**: 新しいユーザー「山田花子」
- **データ**: email: "yamada@example.com", name: "山田花子", age: 28
- **実装**: `prisma.user.upsert()` を使用
- **実務ポイント**: 存在する場合は更新、しない場合は作成

### 🚨 実務で重要なポイント

#### ❌ やらかしがちなこと
```typescript
// 存在確認なしでいきなり更新 → エラーで処理が止まる
await prisma.user.update({
  where: { id: 999 }, // 存在しないID
  data: { age: 30 }
})
```

#### ✅ 安全な実装
```typescript
// 事前確認 or upsert使用
const user = await prisma.user.findUnique({ where: { id: 999 } })
if (user) {
  await prisma.user.update({ ... })
}
```

### 作業手順

1. 問題003までが完了していることを確認
2. `workspace/problems/problem-004.ts`のTODO部分を実装
3. 実装したプログラムをコンパイル・実行
4. 各タスクの結果を確認（エラーも含めて）

### 実行コマンド

```bash
# コンテナに接続
docker-compose exec prisma-app sh

# 前提条件: 問題002のユーザーデータが必要
# TypeScriptコンパイル・実行
npx tsc workspace/problems/problem-004.ts --outDir ./temp
node temp/problem-004.js
```

### 期待する出力

```
🔄 ユーザー情報更新を開始します...

✅ 田中太郎の年齢を26歳に更新しました
❌ ID: 999のユーザーは存在しません (エラーハンドリング成功)
✅ 山田花子を新規作成しました (upsert)

🎉 更新処理が完了しました！
```

### ヒント

- **update()**: 既存レコード必須、存在しない場合はエラー
- **upsert()**: 存在する場合は更新、しない場合は作成
- **where句**: 更新対象の特定に使用
- **data句**: 更新するフィールドと値を指定