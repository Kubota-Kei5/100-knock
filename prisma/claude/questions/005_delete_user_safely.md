# 問題005: ユーザーの安全な削除（実務重要度★★★）

## 問題内容

Prisma Clientを使用して、Userレコードを**安全に削除**するプログラムを実装してください。

この問題では**実務で非常に重要**な「削除の危険性」について学習します。

### ⚠️ 実務での「削除」の危険性

#### 💥 削除で起こりうる「やらかし」
1. **間違ったレコードの削除** - 条件ミスで大切なデータが消失
2. **一括削除の事故** - `deleteMany`で意図しない範囲を削除
3. **復旧不可能** - 削除されたデータは基本的に復元できない
4. **関連データの整合性問題** - 後の問題で学習

### 🎯 削除タスク

以下の削除処理を**慎重に**実装してください：

#### タスク1: 単一レコードの削除
- **対象**: ID: 3のユーザー（鈴木次郎）
- **実装**: `prisma.user.delete()` を使用
- **前提**: 事前に存在確認を行う

#### タスク2: 存在しないレコードの削除（エラー体験）
- **対象**: ID: 999のユーザー（存在しない）
- **期待結果**: エラーが発生し、適切に処理されること

#### タスク3: 条件付き削除の危険性体験
- **対象**: age が null のユーザー
- **実装**: まず `count` で対象を確認 → 削除実行
- **実務ポイント**: 削除前の件数確認は必須

#### タスク4: 削除の取り消し不可体験
- **実装**: 削除後に復元を試みる（当然失敗する）
- **学習目的**: 削除の不可逆性を体感

### 🔒 安全な削除のベストプラクティス

#### ✅ 削除前チェックリスト
1. **存在確認**: 削除対象が本当に存在するか
2. **件数確認**: 削除される件数を事前に確認
3. **条件確認**: WHERE条件が意図通りか
4. **影響範囲確認**: 関連データへの影響はないか
5. **バックアップ確認**: 必要に応じてデータをバックアップ

### 作業手順

1. 問題004までが完了していることを確認
2. `workspace/problems/problem-005.ts`を実装
3. **特に慎重に**実行して各タスクの結果を確認

### 実行コマンド

```bash
# コンテナに接続
docker-compose exec prisma-app sh

# TypeScriptコンパイル・実行
npx tsc workspace/problems/problem-005.ts --outDir ./temp
node temp/problem-005.js
```

### 期待する出力

```
⚠️  ユーザー削除処理を開始します（慎重に実行）...

🔍 削除前の確認: 鈴木次郎(ID:3)は存在します
✅ 鈴木次郎を削除しました

❌ ID: 999のユーザーは存在しません (削除不可)

🔍 age が null のユーザー: 0人（既に削除済み）
ℹ️  削除対象がありません

⚠️  削除は取り消しできません！データは永久に失われました

🎉 削除処理が完了しました
```

### 💡 実装のヒント

- **事前確認**: `findUnique`で存在チェック
- **件数確認**: `count`で対象件数を確認
- **条件指定**: `where`句の条件を慎重に設定
- **エラーハンドリング**: 削除失敗時の適切な処理

### 🚨 重要な注意事項

- **この問題は実際にデータを削除します**
- **削除されたデータは復元できません**
- **実行前に削除対象を慎重に確認してください**
- **本番環境では絶対にテスト削除を行わないでください**